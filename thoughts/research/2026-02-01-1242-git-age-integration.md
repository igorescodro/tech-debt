---
date: 2026-02-01T12:42:07-05:00
git_commit: 1cd920acda0159b84329e3c39a0f7e838aa8a9e0
branch: main
repository: TechDebt
topic: "Git age calculation and new architecture integration"
tags: [research, codebase, git, techdebt]
status: complete
---

# Research: Git age calculation and new architecture integration

## Research Question
Re-implement the code from the branch `feature/git-age` using the new structure that splits parsing and processing into different classes and functions.

## Summary
The goal is to integrate Git age calculation (using JGit) into the technical debt report generation. The current architecture uses specific parsers (`GeneratedTechDebtParser` for KSP and `CommentParser` for source code comments) and a reporting task (`GenerateTechDebtReportTask`). The `feature/git-age` branch provides the logic for using JGit to blame files and extract commit dates.

## Detailed Findings

### Git Age Logic (from `feature/git-age`)
- Uses JGit's `BlameCommand` to find the last commit for a specific line in a file.
- Requires resolving the physical file path from the `TechDebtItem`.
- `resolveSourceFile` logic in `feature/git-age` uses heuristics to find files based on class names or relative paths.

### New Architecture (on `main`)
- `GenerateTechDebtReportTask` (line 19): Orchestrates the parsing and report writing.
- `CommentParser` (line 9): Parses TODO/FIXME comments and already provides relative path and line numbers in `sourceSet`.
- `GeneratedTechDebtParser` (line 8): Parses JSON generated by KSP. Currently, it only provides the source set name (e.g., "main", "test").
- `TechDebtItem` (line 17): Data model for tech debt items.

### Integration Points
- **Model**: `TechDebtItem` needs a `date` field.
- **KSP Processor**: `TechDebtSymbolProcessor` and `SuppressSymbolProcessor` need to be updated to provide file path and line number instead of just the source set name, to enable accurate Git blame.
- **Parser**: A new `GitParser` (or `GitMetadataProcessor`) should be created to enrich `TechDebtItem` with Git dates after they are parsed.
- **Task**: `GenerateTechDebtReportTask` should call the new Git processing logic if enabled.
- **Extension**: `TechDebtExtension` needs a flag to enable Git metadata collection.
- **Report**: `HtmlReportGenerator` needs to be updated to display the `date` column.

## Code References
- `techdebt-gradle-plugin/src/main/kotlin/com/escodro/techdebt/gradle/GenerateTechDebtReportTask.kt:48` - Task action where parsers are called.
- `techdebt-gradle-plugin/src/main/kotlin/com/escodro/techdebt/gradle/parser/CommentParser.kt:41` - Where `sourceSet` is set to `relativePath:line`.
- `techdebt-processor/src/main/kotlin/com/escodro/techdebt/processor/TechDebtSymbolProcessor.kt:63` - Where `TechDebtItem` is created in KSP.

## Open Questions
- Should the Git calculation happen per item or per file to optimize performance? (Blame is usually per file).
- How to handle files not yet committed to Git?
