# Git Age Implementation Plan

## Overview
Re-implement the Git age calculation feature from `feature/git-age` branch into the current architecture. This feature adds a "Date" column to the technical debt report, showing when each item was last modified in Git.

## Current State Analysis
- Current architecture uses `GeneratedTechDebtParser` and `CommentParser` to collect items.
- `TechDebtItem` lacks a `date` field.
- KSP processors (`TechDebtSymbolProcessor`, `SuppressSymbolProcessor`) only provide source set name, not file path/line number.
- `CommentParser` already provides file path and line number.
- `HtmlReportGenerator` doesn't have a "Date" column.

## Desired End State
- `TechDebtItem` has a `date` field.
- All items (KSP, Suppress, Comment) have accurate file path and line number information.
- A new `GitParser` calculates the last commit date for each item using JGit.
- The HTML report displays the last modified date for each tech debt item.
- Users can enable/disable this feature via `techDebtReport { enableGitMetadata = true }`.

## Implementation Phases

### Phase 1: Dependency and Model Updates
1. Add JGit dependency to `libs.versions.toml`.
2. Add JGit dependency to `techdebt-gradle-plugin/build.gradle.kts`.
3. Add `date` property to `TechDebtItem` (optional, default null).
4. Add `enableGitMetadata` property to `TechDebtExtension` and `GenerateTechDebtReportTask`.

### Phase 2: KSP Processor Updates
1. Update `TechDebtItem` in `techdebt-processor` (shared model) if needed.
2. Update `TechDebtSymbolProcessor` to include file path and line number in `sourceSet`.
3. Update `SuppressSymbolProcessor` to include file path and line number in `sourceSet`.

### Phase 3: Git Metadata Collection
1. Create `com.escodro.techdebt.gradle.parser.GitParser`.
2. Implement Git blame logic in `GitParser` using JGit.
3. Integrate `GitParser` into `GenerateTechDebtReportTask`.

### Phase 4: Reporting
1. Update `HtmlReportGenerator` to add the "Date" column to the table.
2. Ensure it handles missing dates gracefully.

## Success Criteria

### Automated Verification:
- [ ] `./gradlew build` passes.
- [ ] New tests for `GitParser` pass.
- [ ] KSP processor tests verify `sourceSet` contains path and line.

### Manual Verification:
- [ ] Generate report with `enableGitMetadata = true` and verify "Date" column is populated.
- [ ] Verify dates match `git blame` for those lines.
